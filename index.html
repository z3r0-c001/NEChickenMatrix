<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choosing Your New England Flock</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico"> <!-- Favicon added here -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* Base body styles for font and background color */
        body {
            font-family: 'Inter', sans-serif;
            /* Changed background to use the provided image URL */
            background-image: url('https://z3r0-c001.github.io/NEChickenMatrix/images/background/bg.png');
            background-repeat: repeat;
            /* Adjust as needed: no-repeat, repeat-x, repeat-y */
            background-attachment: fixed;
            /* Makes the background fixed while scrolling */
            background-size: auto;
            /* Changed from 'cover' to 'auto' for tiling without stretching */
            min-height: 100vh;
            /* Ensure background covers full viewport height */
            line-height: 1.7;
            font-size: 1.1rem;
        }

        /* Chart container for responsive sizing */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            /* Keep max-width for overall chart sizing */
            margin-left: auto;
            margin-right: auto;
            /* Height and max-height are now controlled by Tailwind classes on individual HTML elements */
        }

        /* Responsive adjustment for smaller screens */
        @media (max-width: 768px) {
            /* No fixed height needed here, handled by Tailwind */
        }

        /* Flowchart node styling: main blocks */
        /* Removed as part of the new interactive guide */
        /* Flowchart connector line */
        /* Removed as part of the new interactive guide */
        /* Flowchart connector arrow */
        /* Removed as part of the new interactive guide */
        /* Horizontal line for branches in flowchart */
        /* Removed as part of the new interactive guide */
        /* Vertical line for branches in flowchart */
        /* Removed as part of the new interactive guide */
        /* Left horizontal line for branches */
        /* Removed as part of the new interactive guide */
        /* Right horizontal line for branches */
        /* Removed as part of the new interactive guide */
        /* Styling for egg color dots */
        .egg-color-dot {
            display: inline-block;
            width: 14px;
            /* Slightly larger */
            height: 14px;
            /* Slightly larger */
            border-radius: 50%;
            margin-right: 10px;
            /* More spacing */
            border: 1px solid rgba(0, 0, 0, 0.2);
            /* Softer border */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
            /* Inner shadow for depth */
        }

        /* Custom text shadow for numbers */
        .text-shadow-strong {
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        /* Tailwind overrides for more rounded elements */
        .rounded-lg {
            border-radius: 1rem;
        }

        .rounded-md {
            border-radius: 0.6rem;
        }

        /* Specific styling for form fields in the "Add a Custom Breed" section */
        #customBreedForm input[type="text"],
        #customBreedForm input[type="number"],
        #customBreedForm select {
            background-color: #FDFEFE;
            /* Very light, almost white background */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* Subtle drop shadow */
            border-color: #E0E0E0;
            /* Lighter border color */
        }

        #customBreedForm input[type="text"]:focus,
        #customBreedForm input[type="number"]:focus,
        #customBreedForm select:focus {
            box-shadow: 0 0 0 3px rgba(255, 111, 0, 0.3), 0 2px 5px rgba(0, 0, 0, 0.15);
            /* Orange focus ring with enhanced shadow */
            border-color: #FF6F00;
            /* Dark Orange border on focus */
        }

        /* --- New Interactive Guide Styles --- */
        .guide-step {
            background-color: #fff;
            padding: 2.5rem;
            /* Increased padding */
            border-radius: 1rem;
            /* More rounded corners */
            box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.15), 0 3px 6px -3px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 500px;
            text-align: center;
            margin: 0 auto;
            /* Center the block */
            border-top: 8px solid;
            /* Top border for accent */
        }

        .guide-step button {
            transition: all 0.2s ease-in-out;
            transform: translateY(0);
        }

        .guide-step button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Specific colors for buttons based on their purpose */
        #goal-eggs-btn {
            border-color: #1D8A99;
            background-color: #1D8A99;
        }

        #goal-meat-btn {
            border-color: #FF6F00;
            background-color: #FF6F00;
        }

        #meat-eggs-btn {
            border-color: #FF6F00;
            background-color: #FF6F00;
        }

        #meat-fast-btn {
            border-color: #2F4F4F;
            background-color: #2F4F4F;
        }

        .result-box.layer {
            border-color: #1D8A99;
            background-color: #1D8A99;
        }

        .result-box.dual {
            border-color: #FF6F00;
            background-color: #FF6F00;
        }

        .result-box.meat {
            border-color: #2F4F4F;
            background-color: #2F4F4F;
        }

        .reset-button {
            border-color: #8B0000;
            background-color: #8B0000;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>

<body>

    <header class="bg-gradient-to-r from-green-700 to-green-900 shadow-2xl text-white">
        <div class="container mx-auto px-6 py-14 text-center relative z-10">
            <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight drop-shadow-lg">Choosing Your New England
                Flock</h1>
            <p class="mt-5 text-xl text-white opacity-90 max-w-4xl mx-auto leading-relaxed">An interactive infographic
                guide to selecting the best cold-hardy chicken breeds for your homestead, whether you're seeking
                abundant eggs, delicious meat, or a perfect blend of both.</p>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-10">

        <section
            class="grid grid-cols-1 md:grid-cols-3 gap-10 text-center mb-20 border-2 border-dashed border-gray-200 p-8 rounded-2xl shadow-xl">
            <div
                class="bg-white p-8 rounded-2xl shadow-xl border-t-8 border-[#1D8A99] transform hover:scale-105 transition-transform duration-300">
                <h2 class="text-3xl font-bold text-[#1D8A99] mb-4">Top Egg Layers</h2>
                <p class="text-6xl font-black text-gray-900 my-6 text-shadow-strong">330+</p>
                <p class="text-xl text-gray-900 leading-relaxed font-semibold">eggs per year from top-performing breeds
                    perfect for consistent, fresh production.</p>
            </div>
            <div
                class="bg-white p-8 rounded-2xl shadow-xl border-t-8 border-[#FF6F00] transform hover:scale-105 transition-transform duration-300">
                <h2 class="text-3xl font-bold text-[#FF6F00] mb-4">Dual-Purpose Power</h2>
                <p class="text-6xl font-black text-gray-900 my-6 text-shadow-strong">13 lbs</p>
                <p class="text-xl text-gray-900 leading-relaxed font-semibold">is the potential weight of robust meat
                    chickens, and roosters.</p>
            </div>
            <div
                class="bg-white p-8 rounded-2xl shadow-xl border-t-8 border-[#2F4F4F] transform hover:scale-105 transition-transform duration-300">
                <h2 class="text-3xl font-bold text-[#2F4F4F] mb-4">Efficient Meat Birds</h2>
                <p class="text-6xl font-black text-gray-900 my-6 text-shadow-strong">8 Weeks</p>
                <p class="text-xl text-gray-900 leading-relaxed font-semibold">is all it takes for specialized meat
                    breeds like the Cornish Cross to reach market weight quickly.</p>
            </div>
        </section>

        <section class="bg-white p-8 md:p-10 rounded-2xl shadow-xl mb-20 border-2 border-dashed border-gray-200">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#1D8A99] drop-shadow-sm">The Egg Producers: A Race to
                the Top</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">For those
                prioritizing a steady supply of fresh eggs, these breeds are the undisputed champions. This chart
                compares the maximum annual egg output of the most prolific layers and dual-purpose breeds suitable for
                New England's climate. The Golden Comet stands out as a true production powerhouse, while dual-purpose
                birds like the Plymouth Rock also contribute significantly.</p>
            <div class="chart-container h-[400px] md:h-[450px]">
                <canvas id="eggLayersChart"></canvas>
            </div>
        </section>

        <section class="bg-white p-8 md:p-10 rounded-2xl shadow-xl mb-20 border-2 border-dashed border-gray-200">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#FF6F00] drop-shadow-sm">Dual-Purpose Breeds: Balancing
                Eggs & Size</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">
                Dual-purpose breeds are the homesteader's workhorse, offering a valuable combination of eggs and meat.
                This scatter plot visualizes the trade-off: each point represents a breed, showing how average rooster
                weight relates to annual egg production. Breeds like the Plymouth Rock offer a fantastic, balanced
                middle ground.</p>
            <div class="chart-container h-[400px] md:h-[450px]">
                <canvas id="dualPurposeChart"></canvas>
            </div>
        </section>

        <section class="bg-white p-8 md:p-10 rounded-2xl shadow-xl mb-20 border-2 border-dashed border-gray-200">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#2F4F4F] drop-shadow-sm">The Meat Producers: A Race to
                the Table</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">When meat
                is the goal, efficiency and growth rate are paramount. This chart compares the average weeks required
                for popular meat and dual-purpose breeds to reach a suitable slaughter weight, providing an average
                weight at maturity in the tooltip. Note how heritage breeds like the Jersey Giant take longer but offer
                rich flavor.</p>
            <div class="chart-container h-[400px] md:h-[450px]">
                <canvas id="meatProducersChart"></canvas>
            </div>
        </section>

        <section
            class="grid grid-cols-1 lg:grid-cols-2 gap-10 mb-20 border-2 border-dashed border-gray-200 p-6 md:p-8 rounded-2xl shadow-xl">
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl">
                <h2 class="text-4xl font-bold text-center mb-4 text-[#2F4F4F] drop-shadow-sm">Time to Table: Growth &
                    Maturity</h2>
                <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">For
                    meat production, time is a critical factor. This timeline illustrates the typical weeks needed for
                    dual-purpose and meat breeds to reach slaughter weight. The difference between a hybrid and a
                    heritage breed is stark.</p>
                <div class="space-y-8">
                    <div class="relative pl-8">
                        <div class="absolute left-0 top-0 h-full w-2 bg-gray-200 rounded-full"></div>
                        <div class="absolute left-0 top-0 w-2 h-2 bg-[#8B0000] rounded-full mt-2 -ml-0.5"></div>
                        <h3 class="font-extrabold text-[#8B0000] text-2xl mb-1">8-10 Weeks</h3>
                        <p class="text-lg text-gray-800 font-semibold"><strong>Cornish Cross:</strong> Unmatched speed,
                            the commercial standard for rapid growth.</p>
                    </div>
                    <div class="relative pl-8">
                        <div class="absolute left-0 top-0 h-full w-2 bg-gray-200 rounded-full"></div>
                        <div class="absolute left-0 top-0 w-2 h-2 bg-[#FF6F00] rounded-full mt-2 -ml-0.5"></div>
                        <h3 class="font-extrabold text-[#FF6F00] text-2xl mb-1">12-20 Weeks</h3>
                        <p class="text-lg text-gray-800 font-semibold"><strong>Delaware, Wyandotte, Plymouth Rock, New
                                Hampshire Red:</strong> The sweet spot for many homesteaders, balancing growth and
                            flavor.</p>
                    </div>
                    <div class="relative pl-8">
                        <div class="absolute left-0 top-0 h-full w-2 bg-gray-200 rounded-full"></div>
                        <div class="absolute left-0 top-0 w-2 h-2 bg-[#1D8A99] rounded-full mt-2 -ml-0.5"></div>
                        <h3 class="font-extrabold text-[#1D8A99] text-2xl mb-1">20-26+ Weeks</h3>
                        <p class="text-lg text-gray-800 font-semibold"><strong>Brahma, Chantecler, Orpington, Jersey
                                Giant:</strong> Slower-growing heritage giants that develop rich, deep flavor.</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl overflow-visible">
                <h2 class="text-4xl font-bold text-center mb-4 text-[#1D8A99] drop-shadow-sm">
                    Breed Weight Classes
                </h2>
                <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">
                    The breeds we've listed fall into distinct weight categories. This chart shows the distribution,
                    highlighting that the majority are substantial birds well-suited for cold climates.
                </p>
  <div class="chart-container h-[300px] md:h-[332.5px] w-full overflow-visible relative">
    <!-- Shrink graph to 75% width and center it -->
    <canvas id="weightDistributionChart" class="w-4/6 max-w-[600px] h-full mx-auto">       
    </canvas>
  </div>
            </div>
            </div>
        </section>

        <section class="bg-white p-8 md:p-10 rounded-2xl shadow-xl mb-20 border-2 border-dashed border-gray-200">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#8B0000] drop-shadow-sm">Which Flock is For You?</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-12 leading-relaxed font-semibold text-center">Answer
                these simple questions to find the breed category that best matches your homesteading goals.</p>

            <div id="decision-guide" class="flex flex-col items-center">
                <!-- Step 1: Main Question and Buttons -->
                <div id="step1" class="guide-step border-[#8B0000]">
                    <h3 class="text-3xl font-extrabold text-gray-900 mb-6">What's your homestead goal?</h3>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button id="goal-eggs-btn"
                            class="text-white font-extrabold py-4 px-8 rounded-lg text-xl shadow-md">Tons of
                            Eggs!</button>
                        <button id="goal-meat-btn"
                            class="text-white font-extrabold py-4 px-8 rounded-lg text-xl shadow-md">Meat &
                            Self-Sufficiency</button>
                    </div>
                </div>

                <!-- Step 2: Meat Branching Question and Buttons (Initially hidden) -->
                <div id="step2-meat" class="guide-step border-[#FF6F00] hidden mt-10">
                    <h3 class="text-3xl font-extrabold text-gray-900 mb-6">Do you want eggs from your meat birds too, or
                        just fast growth?</h3>
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button id="meat-eggs-btn"
                            class="text-white font-extrabold py-4 px-8 rounded-lg text-xl shadow-md">I want eggs
                            too!</button>
                        <button id="meat-fast-btn"
                            class="text-white font-extrabold py-4 px-8 rounded-lg text-xl shadow-md">Fastest growth is
                            key!</button>
                    </div>
                    <button id="reset-btn-step2"
                        class="reset-button text-white font-bold py-2 px-4 rounded-full text-sm mt-8">Start
                        Over</button>
                </div>

                <!-- Results (Initially hidden) -->
                <div id="result-layer"
                    class="result-box layer text-white p-8 rounded-2xl shadow-xl hidden mt-10 w-full max-w-md">
                    <h4 class="text-3xl font-black mb-3">Your Best Fit: Layer Breeds</h4>
                    <p class="text-xl text-white opacity-95 font-semibold leading-relaxed">Consider: Golden Comet,
                        Leghorn, Rhode Island Red</p>
                    <button id="reset-btn-layer"
                        class="reset-button text-white font-bold py-2 px-4 rounded-full text-sm mt-8">Start
                        Over</button>
                </div>

                <div id="result-dual"
                    class="result-box dual text-white p-8 rounded-2xl shadow-xl hidden mt-10 w-full max-w-md">
                    <h4 class="text-3xl font-black mb-3">Go Dual-Purpose</h4>
                    <p class="text-xl text-white opacity-95 font-semibold leading-relaxed">Consider: Wyandotte, Plymouth
                        Rock, Orpington</p>
                    <button id="reset-btn-dual"
                        class="reset-button text-white font-bold py-2 px-4 rounded-full text-sm mt-8">Start
                        Over</button>
                </div>

                <div id="result-meat"
                    class="result-box meat text-white p-8 rounded-2xl shadow-xl hidden mt-10 w-full max-w-md">
                    <h4 class="text-3xl font-black mb-3">Choose Meat Breeds</h4>
                    <p class="text-xl text-white opacity-95 font-semibold leading-relaxed">Consider: Cornish Cross,
                        Freedom Ranger</p>
                    <button id="reset-btn-meat"
                        class="reset-button text-white font-bold py-2 px-4 rounded-full text-sm mt-8">Start
                        Over</button>
                </div>
            </div>
        </section>

        <section id="flockBuilder"
            class="bg-white p-8 md:p-10 rounded-2xl shadow-xl border-2 border-dashed border-gray-200 mb-20">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#8B0000] drop-shadow-sm">Build Your Dream Flock</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">Use this
                intuitive tool to design your ideal flock and project its output. Add breeds, specify quantities, and
                get instant estimates for your annual egg and meat production.</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div>
                    <h3 class="text-2xl font-bold mb-5 text-gray-800">1. Add Birds to Your Flock</h3>
                    <div class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-100">
                        <div class="flex flex-col sm:flex-row gap-5 mb-5">
                            <div class="flex-grow">
                                <label for="breedSelect" class="block text-lg font-bold text-gray-900 mb-2">Select
                                    Breed</label>
                                <select id="breedSelect"
                                    class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all"></select>
                            </div>
                            <div>
                                <label for="quantityInput"
                                    class="block text-lg font-bold text-gray-900 mb-2">Quantity</label>
                                <input type="number" id="quantityInput" value="1" min="1"
                                    class="block w-full sm:w-32 px-4 py-3 text-lg border-gray-300 rounded-md text-center focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                            </div>
                        </div>
                        <button id="addBirdBtn"
                            class="w-full bg-[#1D8A99] text-white font-extrabold py-3 px-6 rounded-lg text-lg shadow-md hover:bg-[#156a74] transition-colors duration-300 transform hover:scale-105">Add
                            to Flock</button>
                    </div>
                </div>

                <div class="row-span-2">
                    <h3 class="text-2xl font-bold mb-5 text-gray-800">2. Your Current Flock</h3>
                    <div id="flockList"
                        class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-100 min-h-[250px] overflow-y-auto">
                        <p id="flockPlaceholder" class="text-xl text-gray-800 text-center mt-12 font-semibold">Your
                            flock is currently empty. Start by adding some birds!</p>
                    </div>
                    <button id="resetFlockBtn"
                        class="mt-6 w-full bg-[#8B0000] text-white font-extrabold py-3 px-6 rounded-lg text-lg shadow-md hover:bg-[#6b0000] transition-colors duration-300 transform hover:scale-105 hidden">Reset
                        Flock</button>
                </div>

                <div>
                    <h3 class="text-2xl font-bold mb-5 text-gray-800">3. Calculate Production</h3>
                    <div id="calculationResults"
                        class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-100 space-y-6">
                        <div class="text-xl text-gray-800 text-center font-semibold">
                            <p>Add birds to your flock to see detailed production estimates.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="flockEconomics"
            class="bg-white p-8 md:p-10 rounded-2xl shadow-xl border-2 border-dashed border-gray-200 mb-20">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#1D8A99] drop-shadow-sm">Flock Economics: Profit &
                Costs</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">Estimate
                your potential profits and costs. Default values are based on average research, but feel free to adjust
                them to your local market for accurate projections!</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                <div>
                    <h3 class="text-2xl font-bold mb-5 text-gray-800">Set Your Costs & Prices</h3>
                    <div class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-100 space-y-5">
                        <div>
                            <label for="chickCostLayerInput" class="block text-lg font-bold text-gray-900 mb-2">Cost per
                                Layer Chick ($)</label>
                            <input type="number" id="chickCostLayerInput" value="4.00" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="chickCostDualPurposeInput"
                                class="block text-lg font-bold text-gray-900 mb-2">Cost per Dual-Purpose Chick
                                ($)</label>
                            <input type="number" id="chickCostDualPurposeInput" value="3.50" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="chickCostMeatInput"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">Cost
                                per Meat Chick ($)</label>
                            <input type="number" id="chickCostMeatInput" value="2.50" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="dailyFeedCostInput" class="block text-lg font-bold text-gray-900 mb-2">Avg.
                                Daily Feed Cost per Bird ($)</label>
                            <input type="number" id="dailyFeedCostInput" value="0.15" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="eggPriceDozenInput" class="block text-lg font-bold text-gray-900 mb-2">Selling
                                Price per Dozen Eggs ($)</label>
                            <input type="number" id="eggPriceDozenInput" value="5.00" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="meatPriceLbInput" class="block text-lg font-bold text-gray-900 mb-2">Selling
                                Price per lb of Meat ($)</label>
                            <input type="number" id="meatPriceLbInput" value="3.00" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                        <div>
                            <label for="initialSetupCostInput"
                                class="block text-lg font-bold text-gray-900 mb-2">Initial Coop/Brooder Setup Cost
                                ($)</label>
                            <input type="number" id="initialSetupCostInput" value="750.00" min="0" step="0.01"
                                class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-2xl font-bold mb-5 text-gray-800">Your Economic Snapshot</h3>
                    <div id="economicResults"
                        class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-100 space-y-6">
                        <div class="text-xl text-gray-800 text-center font-semibold">
                            <p>Add birds to your flock to see your economic projections.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="breedCharacteristics"
            class="bg-white p-8 md:p-10 rounded-2xl shadow-xl mb-20 border-2 border-dashed border-gray-200">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#DAA520] drop-shadow-sm">Breeds and Their
                Characteristics</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">Explore
                the details of each chicken breed, including their typical appearance, egg-laying capabilities, size,
                and more.</p>

            <div class="flex flex-col items-center">
                <div class="w-full max-w-md mb-8">
                    <label for="breedCharacteristicsSelect" class="block text-lg font-bold text-gray-900 mb-2">Select a
                        Breed to Learn More</label>
                    <select id="breedCharacteristicsSelect"
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all"></select>
                </div>
                <div id="breedCharacteristicsDisplay"
                    class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-100 w-full max-w-2xl min-h-[300px] flex items-center justify-center text-xl text-gray-800 font-semibold">
                    Select a breed to see its characteristics.
                </div>
            </div>
        </section>

        <section class="bg-white p-8 md:p-10 rounded-2xl shadow-xl mb-20 border-2 border-dashed border-gray-200">
            <h2 class="text-4xl font-bold text-center mb-4 text-[#FF6F00] drop-shadow-sm">Add a Custom Breed</h2>
            <p class="text-xl text-gray-900 max-w-4xl mx-auto mb-10 leading-relaxed font-semibold text-center">Define
                your own chicken breed to add to your flock. Custom breeds will instantly appear in the breed selection
                dropdown for calculation.</p>
            <form id="customBreedForm" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <label for="customBreedName" class="block text-lg font-bold text-gray-900 mb-2">Breed Name</label>
                    <input type="text" id="customBreedName" required
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                </div>
                <div>
                    <label for="customBreedType" class="block text-lg font-bold text-gray-900 mb-2">Type</label>
                    <select id="customBreedType" required
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                        <option value="Layer">Layer</option>
                        <option value="Dual-Purpose">Dual-Purpose</option>
                        <option value="Meat">Meat</option>
                    </select>
                </div>
                <div>
                    <label for="customBreedEggs" class="block text-lg font-bold text-gray-900 mb-2">Avg.
                        Eggs/Year</label>
                    <input type="number" id="customBreedEggs" min="0" value="0"
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                </div>
                <div>
                    <label for="customBreedWeightHen" class="block text-lg font-bold text-gray-900 mb-2">Hen Weight
                        (lbs)</label>
                    <input type="number" id="customBreedWeightHen" min="0" step="0.1" value="0"
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                </div>
                <div>
                    <label for="customBreedWeightRooster" class="block text-lg font-bold text-gray-900 mb-2">Rooster
                        Weight (lbs)</label>
                    <input type="number" id="customBreedWeightRooster" min="0" step="0.1" value="0"
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                </div>
                <div>
                    <label for="customBreedSlaughterAge" class="block text-lg font-bold text-gray-900 mb-2">Slaughter
                        Age (weeks)</label>
                    <input type="number" id="customBreedSlaughterAge" min="0" step="1" value=""
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                </div>
                <div>
                    <label for="customBreedEggColor" class="block text-lg font-bold text-gray-900 mb-2">Egg
                        Color</label>
                    <input type="text" id="customBreedEggColor"
                        class="block w-full px-4 py-3 text-lg border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                </div>
                <!-- New: Image upload field -->
                <div class="md:col-span-2">
                    <label for="customBreedImage" class="block text-lg font-bold text-gray-900 mb-2">Upload Image
                        (Optional)</label>
                    <input type="file" id="customBreedImage" accept="image/*"
                        class="block w-full text-lg text-gray-900 border border-gray-300 rounded-md cursor-pointer bg-gray-50 focus:outline-none focus:ring-2 focus:ring-[#FF6F00] focus:border-transparent transition-all">
                    <img id="imagePreview" src="" alt="Image Preview"
                        class="mt-4 hidden w-32 h-32 object-cover rounded-md shadow-md mx-auto border border-gray-200">
                </div>
                <div class="md:col-span-2 flex justify-center mt-4">
                    <button id="addCustomBreedBtn" type="submit"
                        class="bg-[#2F4F4F] text-white font-extrabold py-3 px-8 rounded-lg text-lg shadow-md hover:bg-[#1f2f2f] transition-colors duration-300 transform hover:scale-105">Add
                        Custom Breed</button>
                </div>
            </form>
        </section>


    </main>

    <footer class="bg-gradient-to-r from-green-700 to-green-900 text-white py-10">
        <div class="container mx-auto px-6 text-center">
            <p class="text-lg">&copy; <span id="current-year"></span> The Good Supply Farm</p>
            <div class="mt-4">
                <img src="https://z3r0-c001.github.io/NEChickenMatrix/images/background/waxer.png"
                    alt="Good Supply Farm Logo" class="mx-auto h-72 w-auto object-contain mb-4">
            </div>
            <p class="text-md mt-2 opacity-80">Designed with passion for homesteaders.</p>
            <div class="mt-4 space-x-4">
                <a href="/LICENSE" class="text-white hover:underline opacity-90">LICENSE</a>
                <a href="/README" class="text-white hover:underline opacity-90">README</a>
            </div>
        </div>
    </footer>

    <script>
        // Updated Data for the charts and breed characteristics
        const breedData = [
            {
                name: "Australorp",
                type: "Dual-Purpose", // Changed from 'Layer/Dual' to 'Dual-Purpose'
                eggsPerYear: 275,
                henWeight: 6.5,
                roosterWeight: 8.5,
                slaughterAgeWeeks: null, // As per new data, slaughterAge is null for Australorp
                eggColor: "Brown",
                characteristics: "Known for their iridescent black-green plumage and gentle nature. Excellent layers, holding a world record for egg production. Also good meat birds. Hardy and active.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/australorp.png"
            },
            {
                name: "Brahma",
                type: "Dual-Purpose",
                eggsPerYear: 170,
                henWeight: 9.5,
                roosterWeight: 12,
                slaughterAgeWeeks: 22,
                eggColor: "Brown",
                characteristics: "Giant, gentle giants. Very large and docile, known for excellent cold-hardiness due to feathered legs and dense plumage. Lay large brown eggs, especially well in winter. Good for meat, but slow-growing.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/brahma.png"
            },
            {
                name: "Buckeye",
                type: "Dual-Purpose",
                eggsPerYear: 190,
                henWeight: 6,
                roosterWeight: 7,
                slaughterAgeWeeks: 18,
                eggColor: "Brown",
                characteristics: "Developed in Ohio specifically for cold climates, Buckeyes are active, calm, and good foragers. They are excellent dual-purpose birds, providing both eggs and meat. Known for their unique dark mahogany plumage.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/buckeye.png"
            },
            {
                name: "Chantecler",
                type: "Dual-Purpose",
                eggsPerYear: 200,
                henWeight: 7,
                roosterWeight: 9,
                slaughterAgeWeeks: 20,
                eggColor: "Brown",
                characteristics: "A truly cold-hardy Canadian breed, distinguished by its cushion comb which prevents frostbite. Good dual-purpose bird, laying well even in winter and providing a good meat carcass. Calm temperament.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/chantecler.png"
            },
            {
                name: "Cochin",
                type: "Dual-Purpose",
                eggsPerYear: 150,
                henWeight: 8.5,
                roosterWeight: 11,
                slaughterAgeWeeks: 24,
                eggColor: "Brown",
                characteristics: "Large, fluffy, and docile birds known for their feathered legs. Good for both meat and ornamental purposes, and lay a fair number of brown eggs. Very cold-hardy and prone to broodiness.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/cochin.png"
            },
            {
                name: "Cornish Cross",
                type: "Meat",
                eggsPerYear: 0,
                henWeight: 8,
                roosterWeight: 12,
                slaughterAgeWeeks: 9,
                eggColor: "N/A", // Consistent with original code
                characteristics: "The industry standard for broiler chickens, bred for extremely fast growth and large meat yield. Reach market weight in 8-10 weeks. Not suitable for egg production or long-term keeping.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/cornish_cross.png"
            },
            {
                name: "Delaware",
                type: "Dual-Purpose",
                eggsPerYear: 250,
                henWeight: 6,
                roosterWeight: 8,
                slaughterAgeWeeks: 14,
                eggColor: "Brown",
                characteristics: "A heritage dual-purpose breed, known for its friendly temperament, good egg production, and excellent meat qualities. Active foragers and cold-hardy, with striking black and white plumage.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/deleware.png"
            },
            {
                name: "Easter Egger",
                type: "Layer",
                eggsPerYear: 250,
                henWeight: 4,
                roosterWeight: 5,
                slaughterAgeWeeks: null,
                eggColor: "Blue/Green", // Simplified from Blue/Green/Pink
                characteristics: "Known for laying blue or green eggs. Ameraucanas are a specific breed; Easter Eggers are hybrids with Ameraucana traits. Generally friendly and cold-hardy. Primarily kept for novelty egg colors.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/easter_egger.png"
            },
            {
                name: "Freedom Ranger",
                type: "Meat",
                eggsPerYear: 0,
                henWeight: 6,
                roosterWeight: 9,
                slaughterAgeWeeks: 11,
                eggColor: "N/A", // Consistent with original code
                characteristics: "A slower-growing broiler than the Cornish Cross, offering a more active and natural foraging chicken, with healthier growth. Excellent meat quality. Good alternative for pastured poultry.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/freedom_ranger.png"
            },
            {
                name: "Giant Cochin",
                type: "Dual-Purpose",
                eggsPerYear: 160,
                henWeight: 11,
                roosterWeight: 13,
                slaughterAgeWeeks: 26,
                eggColor: "Brown",
                characteristics: "Even larger than standard Cochins, these gentle giants are excellent for meat and provide a decent number of brown eggs. Very docile and extremely cold-hardy due to heavy feathering.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/giant_cochin.png"
            },
            {
                name: "Golden Comet",
                type: "Layer",
                eggsPerYear: 320,
                henWeight: 4.5,
                roosterWeight: 6,
                slaughterAgeWeeks: null,
                eggColor: "Brown",
                characteristics: "A highly prolific egg layer, known for rapid maturation and consistent brown egg production. Very docile and cold-hardy, making them excellent for beginners. Not ideal for meat.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/golden_comet.png"
            },
            {
                name: "Jersey Giant",
                type: "Dual-Purpose",
                eggsPerYear: 175,
                henWeight: 10,
                roosterWeight: 13,
                slaughterAgeWeeks: 24,
                eggColor: "Brown",
                characteristics: "The largest purebred chicken breed, bred for meat but also decent layers. Very docile and quiet. Take a long time to mature, but offer a very large carcass. Good cold-hardiness.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/jersey_giant.png"
            },
            {
                name: "Marans",
                type: "Dual-Purpose",
                eggsPerYear: 170,
                henWeight: 7,
                roosterWeight: 9,
                slaughterAgeWeeks: 20,
                eggColor: "Dark Brown (Chocolate)", // Consistent with original color
                characteristics: "Prized for their beautiful, very dark brown eggs. Good dual-purpose birds with decent meat yield. Generally calm, but some lines can be flighty. Fairly cold-hardy.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/marans.png"
            },
            {
                name: "New Hampshire Red",
                type: "Dual-Purpose",
                eggsPerYear: 210,
                henWeight: 6.5,
                roosterWeight: 8.5,
                slaughterAgeWeeks: 16,
                eggColor: "Brown",
                characteristics: "Developed from Rhode Island Reds, with an emphasis on faster growth and earlier feathering for meat production, while still being good layers. Energetic and cold-hardy.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/new_hampshire_red.png"
            },
            {
                name: "Orpington",
                type: "Dual-Purpose",
                eggsPerYear: 185,
                henWeight: 8,
                roosterWeight: 10,
                slaughterAgeWeeks: 20,
                eggColor: "Brown",
                characteristics: "Large, fluffy, and extremely docile birds, making them wonderful pets and great for families. Good layers and provide a good amount of meat. Very cold-hardy due to their dense feathering.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/orpington.png"
            },
            {
                name: "Plymouth Rock",
                type: "Dual-Purpose",
                eggsPerYear: 250,
                henWeight: 7.5,
                roosterWeight: 9.5,
                slaughterAgeWeeks: 18,
                eggColor: "Brown",
                characteristics: "A classic American dual-purpose breed, known for its docile temperament, good egg production, and meaty carcass. Very cold-hardy and a good choice for families. Barred Rock is a common variety.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/plymouth_rock.png"
            },
            {
                name: "Rhode Island Red",
                type: "Dual-Purpose",
                eggsPerYear: 275,
                henWeight: 6.5,
                roosterWeight: 8.5,
                slaughterAgeWeeks: null, // As per new data, slaughterAge is null for RIR
                eggColor: "Brown",
                characteristics: "A popular dual-purpose breed, excellent layers of large brown eggs and good for meat. Hardy, active, and can be a bit assertive. Adaptable to various climates.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/rhode_island_red.png"
            },
            {
                name: "Sussex",
                type: "Dual-Purpose",
                eggsPerYear: 260,
                henWeight: 7,
                roosterWeight: 9,
                slaughterAgeWeeks: 18,
                eggColor: "Light Brown", // Simplified from 'Light Brown/Tinted'
                characteristics: "Docile, curious, and adaptable. A great dual-purpose breed, providing a good number of eggs and a decent carcass. Good foragers and cold-hardy. Light Sussex is the most common variety.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/sussex.png"
            },
            {
                name: "White Leghorn",
                type: "Layer",
                eggsPerYear: 310,
                henWeight: 4.5,
                roosterWeight: 6,
                slaughterAgeWeeks: null,
                eggColor: "White",
                characteristics: "The quintessential white egg layer. Highly efficient and productive, but can be flighty and less cold-hardy than other breeds. Best for egg production, not meat.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/white_leghorn.png"
            },
            {
                name: "Wyandotte",
                type: "Dual-Purpose",
                eggsPerYear: 225,
                henWeight: 6.5,
                roosterWeight: 8.5,
                slaughterAgeWeeks: 18,
                eggColor: "Brown",
                characteristics: "Beautiful, docile, and cold-hardy birds. Excellent dual-purpose breed, laying consistently and providing a good meat yield. Many color varieties exist, with Silver Laced being very popular.",
                imageUrl: "https://z3r0-c001.github.io/NEChickenMatrix/images/breeds/wyandotte.png"
            }
        ];

        // Chart.js configurations
        let eggLayersChart, dualPurposeChart, meatProducersChart, weightDistributionChart;

        function renderCharts() {
            // Egg Layers Chart
            const ctxEggLayers = document.getElementById('eggLayersChart').getContext('2d');
            const layerBreeds = breedData.filter(b => b.type === "Layer" || b.type === "Dual-Purpose").sort((a, b) => b.eggsPerYear - a.eggsPerYear);

            // Define a custom set of colors to match the provided image
            const customEggChartColors = [
                '#1D8A99', // Golden Comet (Dark Teal)
                '#8B0000', // White Leghorn (Dark Red)
                '#FF6F00', // Rhode Island Red (Dark Orange)
                '#6A5ACD', // Australorp (Slate Blue/Purple)
                '#228B22', // Sussex (Forest Green)
                '#A0522D', // Plymouth Rock (Sienna Brown)
                '#8FBC8F', // Easter Egger (Dark Sea Green)
                '#6495ED', // Wyandotte (Cornflower Blue)
                '#E9967A', // New Hampshire Red (Dark Salmon)
                '#DAA520', // Chantecler (Goldenrod)
                '#4682B4', // Buckeye (Steel Blue)
                '#CD5C5C', // Orpington (Indian Red)
                '#BDB76B', // Jersey Giant (Dark Khaki)
                '#800080', // Brahma (Purple)
                '#20B2AA', // Marans (Light Sea Green)
                '#D2B48C'  // Giant Cochin (Tan) - Placeholder if this breed existed in the original chart
            ];

            // Destroy existing chart if it exists to prevent re-render issues
            if (eggLayersChart) {
                eggLayersChart.destroy();
            }
            eggLayersChart = new Chart(ctxEggLayers, {
                type: 'bar',
                data: {
                    labels: layerBreeds.map(b => b.name),
                    datasets: [{
                        label: 'Annual Egg Production',
                        data: layerBreeds.map(b => b.eggsPerYear),
                        backgroundColor: customEggChartColors.slice(0, layerBreeds.length), // Apply custom colors
                        borderColor: customEggChartColors.slice(0, layerBreeds.length).map(color => { // Slightly darker border
                            return `rgba(${parseInt(color.slice(1, 3), 16) * 0.8}, ${parseInt(color.slice(3, 5), 16) * 0.8}, ${parseInt(color.slice(5, 7), 16) * 0.8}, 1)`;
                        }),
                        borderWidth: 1,
                        borderRadius: 8, // Rounded bars
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'x', // Changed to x for vertical bars
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    family: 'Inter'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `${context.dataset.label}: ${context.raw} eggs`;
                                }
                            },
                            titleFont: {
                                size: 16,
                                family: 'Inter'
                            },
                            bodyFont: {
                                size: 14,
                                family: 'Inter'
                            },
                            padding: 10,
                            boxPadding: 5,
                            displayColors: true,
                            backgroundColor: 'rgba(0,0,0,0.7)',
                            bodyColor: '#fff',
                            titleColor: '#fff',
                        }
                    },
                    scales: {
                        x: { // x-axis now for breeds
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Breed',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: 'Inter'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                color: '#555'
                            }
                        },
                        y: { // y-axis now for egg production
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Eggs Per Year',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: 'Inter'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                color: '#555'
                            },
                            grid: {
                                display: true // Keep Y-axis grid lines for value readability
                            }
                        }
                    }
                }
            });

            // Dual Purpose Chart (Scatter Plot)
            const ctxDualPurpose = document.getElementById('dualPurposeChart').getContext('2d');
            const dualPurposeBreeds = breedData.filter(b => b.type === "Dual-Purpose" && b.roosterWeight !== null && b.eggsPerYear !== null);

            // Destroy existing chart if it exists
            if (dualPurposeChart) {
                dualPurposeChart.destroy();
            }
            dualPurposeChart = new Chart(ctxDualPurpose, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Dual-Purpose Breeds',
                        data: dualPurposeBreeds.map(b => ({
                            x: b.roosterWeight,
                            y: b.eggsPerYear,
                            name: b.name,
                            henWeight: b.henWeight
                        })),
                        backgroundColor: '#FF6F00',
                        borderColor: '#cc5800',
                        borderWidth: 2,
                        pointRadius: 8,
                        pointHoverRadius: 10,
                        pointBackgroundColor: '#FF6F00',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    family: 'Inter'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const breed = context.raw;
                                    return [
                                        `Breed: ${breed.name}`,
                                        `Rooster Weight: ${breed.x} lbs`,
                                        `Hen Weight: ${breed.henWeight} lbs`,
                                        `Eggs/Year: ${breed.y}`
                                    ];
                                }
                            },
                            titleFont: {
                                size: 16,
                                family: 'Inter'
                            },
                            bodyFont: {
                                size: 14,
                                family: 'Inter'
                            },
                            padding: 10,
                            boxPadding: 5,
                            displayColors: true,
                            backgroundColor: 'rgba(0,0,0,0.7)',
                            bodyColor: '#fff',
                            titleColor: '#fff',
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Rooster Weight (lbs)',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: 'Inter'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                color: '#555'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Average Eggs Per Year',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: 'Inter'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                color: '#555'
                            }
                        }
                    }
                }
            });

            // Meat Producers Chart (Bar Chart - Weeks to Slaughter)
            const ctxMeatProducers = document.getElementById('meatProducersChart').getContext('2d');
            const meatBreeds = breedData.filter(b => b.type === "Meat" || b.type === "Dual-Purpose")
                .filter(b => b.slaughterAgeWeeks !== null)
                .sort((a, b) => a.slaughterAgeWeeks - b.slaughterAgeWeeks); // Sort by slaughter age

            const customMeatChartColors = [
                '#2F4F4F', // Cornish Cross (Dark Slate Gray)
                '#6B8E23', // Freedom Ranger (Olive Drab)
                '#FF6F00', // New Hampshire Red (Dark Orange)
                '#A0522D', // Rhode Island Red (Sienna Brown)
                '#1D8A99', // Delaware (Dark Teal)
                '#DAA520', // Plymouth Rock (Goldenrod)
                '#CD5C5C', // Wyandotte (Indian Red)
                '#6A5ACD', // Australorp (Slate Blue/Purple)
                '#4682B4', // Orpington (Steel Blue)
                '#8B0000', // Sussex (Dark Red)
                '#800080', // Chantecler (Purple)
                '#228B22', // Marans (Forest Green)
                '#BDB76B', // Brahma (Dark Khaki)
                '#008B8B', // Jersey Giant (Dark Cyan)
                '#ADD8E6', // Buckeye (Light Blue)
                '#90EE90'  // Cochin (Light Green)
            ];

            // Destroy existing chart if it exists
            if (meatProducersChart) {
                meatProducersChart.destroy();
            }
            meatProducersChart = new Chart(ctxMeatProducers, {
                type: 'bar',
                data: {
                    labels: meatBreeds.map(b => b.name),
                    datasets: [{
                        label: 'Weeks to Slaughter Weight',
                        data: meatBreeds.map(b => b.slaughterAgeWeeks),
                        backgroundColor: customMeatChartColors.slice(0, meatBreeds.length), // Apply custom colors
                        borderColor: customMeatChartColors.slice(0, meatBreeds.length).map(color => { // Slightly darker border
                            return `rgba(${parseInt(color.slice(1, 3), 16) * 0.8}, ${parseInt(color.slice(3, 5), 16) * 0.8}, ${parseInt(color.slice(5, 7), 16) * 0.8}, 1)`;
                        }),
                        borderWidth: 1,
                        borderRadius: 8,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'x', // Changed to x for vertical bars
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                font: {
                                    size: 14,
                                    family: 'Inter'
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const breed = meatBreeds[context.dataIndex];
                                    return [
                                        `Weeks to Slaughter: ${breed.slaughterAgeWeeks}`,
                                        `Approx. Meat Weight (Hen): ${breed.henWeight} lbs`,
                                        `Approx. Meat Weight (Rooster): ${breed.roosterWeight} lbs`
                                    ];
                                }
                            },
                            titleFont: {
                                size: 16,
                                family: 'Inter'
                            },
                            bodyFont: {
                                size: 14,
                                family: 'Inter'
                            },
                            padding: 10,
                            boxPadding: 5,
                            displayColors: true,
                            backgroundColor: 'rgba(0,0,0,0.7)',
                            bodyColor: '#fff',
                            titleColor: '#fff',
                        }
                    },
                    scales: {
                        x: { // x-axis now for breeds
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Breed',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: 'Inter'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                color: '#555'
                            }
                        },
                        y: { // y-axis now for slaughter weeks
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Weeks to Slaughter',
                                font: {
                                    size: 16,
                                    weight: 'bold',
                                    family: 'Inter'
                                },
                                color: '#333'
                            },
                            ticks: {
                                font: {
                                    size: 12,
                                    family: 'Inter'
                                },
                                color: '#555'
                            }
                        }
                    }
                }
            });

            // Weight Distribution Chart (Pie Chart)
            const ctxWeightDistribution = document.getElementById('weightDistributionChart').getContext('2d');
            const weightClasses = {
                "Small (Under 5 lbs)": 0,
                "Medium (5-7 lbs)": 0,
                "Large (7-9 lbs)": 0,
                "Giant (10+ lbs)": 0
            };

            breedData.forEach(breed => {
                const avgWeight = (breed.henWeight + (breed.roosterWeight || breed.henWeight)) / 2; // Use henWeight if roosterWeight is null
                if (avgWeight < 5) {
                    weightClasses["Small (Under 5 lbs)"]++;
                } else if (avgWeight >= 5 && avgWeight < 7) {
                    weightClasses["Medium (5-7 lbs)"]++;
                } else if (avgWeight >= 7 && avgWeight < 10) {
                    weightClasses["Large (7-9 lbs)"]++;
                } else if (avgWeight >= 10) {
                    weightClasses["Giant (10+ lbs)"]++;
                }
            });

            // Destroy existing chart if it exists
            if (weightDistributionChart) {
                weightDistributionChart.destroy();
            }
            weightDistributionChart = new Chart(ctxWeightDistribution, {
                type: 'pie',
                data: {
                    labels: Object.keys(weightClasses),
                    datasets: [{
                        label: 'Number of Breeds',
                        data: Object.values(weightClasses),
                        backgroundColor: [
                            '#1D8A99', // Cyan
                            '#FF6F00', // Orange
                            '#2F4F4F', // Dark Slate Gray
                            '#8B0000'  // Dark Red
                        ],
                        borderColor: '#fff',
                        borderWidth: 2,
                        hoverOffset: 10, // Slight offset on hover
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                font: {
                                    size: 14,
                                    family: 'Inter'
                                },
                                usePointStyle: true, // Use circles for legend items
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    const label = context.label || '';
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((sum, current) => sum + current, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: ${value} breeds (${percentage}%)`;
                                }
                            },
                            titleFont: {
                                size: 16,
                                family: 'Inter'
                            },
                            bodyFont: {
                                size: 14,
                                family: 'Inter'
                            },
                            padding: 10,
                            boxPadding: 5,
                            displayColors: true,
                            backgroundColor: 'rgba(0,0,0,0.7)',
                            bodyColor: '#fff',
                            titleColor: '#fff',
                        }
                    }
                }
            });
        }

        // --- Decision Guide Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const step1 = document.getElementById('step1');
            const step2Meat = document.getElementById('step2-meat');
            const resultLayer = document.getElementById('result-layer');
            const resultDual = document.getElementById('result-dual');
            const resultMeat = document.getElementById('result-meat');

            const goalEggsBtn = document.getElementById('goal-eggs-btn');
            const goalMeatBtn = document.getElementById('goal-meat-btn');
            const meatEggsBtn = document.getElementById('meat-eggs-btn');
            const meatFastBtn = document.getElementById('meat-fast-btn');
            const resetBtns = document.querySelectorAll('.reset-button');

            function hideAllStepsAndResults() {
                step1.classList.add('hidden');
                step2Meat.classList.add('hidden');
                resultLayer.classList.add('hidden');
                resultDual.classList.add('hidden');
                resultMeat.classList.add('hidden');
            }

            function showStep1() {
                hideAllStepsAndResults();
                step1.classList.remove('hidden');
            }

            goalEggsBtn.addEventListener('click', () => {
                hideAllStepsAndResults();
                resultLayer.classList.remove('hidden');
            });

            goalMeatBtn.addEventListener('click', () => {
                hideAllStepsAndResults();
                step2Meat.classList.remove('hidden');
            });

            meatEggsBtn.addEventListener('click', () => {
                hideAllStepsAndResults();
                resultDual.classList.remove('hidden');
            });

            meatFastBtn.addEventListener('click', () => {
                hideAllStepsAndResults();
                resultMeat.classList.remove('hidden');
            });

            resetBtns.forEach(button => {
                button.addEventListener('click', showStep1);
            });

            // Show the first step on load
            showStep1();


            // --- Flock Builder Logic ---
            const breedSelect = document.getElementById('breedSelect');
            const quantityInput = document.getElementById('quantityInput');
            const addBirdBtn = document.getElementById('addBirdBtn');
            const flockList = document.getElementById('flockList');
            const flockPlaceholder = document.getElementById('flockPlaceholder');
            const resetFlockBtn = document.getElementById('resetFlockBtn');
            const calculationResults = document.getElementById('calculationResults');

            let currentFlock = [];

            // Populate breed select dropdown
            function populateBreedSelect() {
                breedSelect.innerHTML = ''; // Clear existing options
                breedData.forEach(breed => {
                    const option = document.createElement('option');
                    option.value = breed.name;
                    option.textContent = breed.name;
                    breedSelect.appendChild(option);
                });
            }

            // Update flock display and calculations
            function updateFlock() {
                flockList.innerHTML = '';
                if (currentFlock.length === 0) {
                    flockPlaceholder.classList.remove('hidden');
                    resetFlockBtn.classList.add('hidden');
                    calculationResults.innerHTML = `
                        <div class="text-xl text-gray-800 text-center font-semibold">
                            <p>Add birds to your flock to see detailed production estimates.</p>
                        </div>
                    `;
                    economicResults.innerHTML = `
                        <div class="text-xl text-gray-800 text-center font-semibold">
                            <p>Add birds to your flock to see your economic projections.</p>
                        </div>
                    `;
                } else {
                    flockPlaceholder.classList.add('hidden');
                    resetFlockBtn.classList.remove('hidden');

                    let totalEggs = 0;
                    let totalMeatLbs = 0;
                    let totalBirds = 0;
                    let totalLayerChicks = 0;
                    let totalDualPurposeChicks = 0;
                    let totalMeatChicks = 0;

                    currentFlock.forEach((bird, index) => {
                        const breed = breedData.find(b => b.name === bird.name);
                        if (breed) {
                            // Calculate eggs for Layer and Dual-Purpose breeds
                            if (breed.type === "Layer" || breed.type === "Dual-Purpose") {
                                totalEggs += breed.eggsPerYear * bird.quantity;
                            }

                            // Calculate meat for Dual-Purpose and Meat breeds
                            if (breed.type === "Dual-Purpose" || breed.type === "Meat") {
                                const avgSlaughterWeight = (breed.henWeight + (breed.roosterWeight || breed.henWeight)) / 2;
                                totalMeatLbs += avgSlaughterWeight * bird.quantity;
                            }
                            totalBirds += bird.quantity;

                            // For economic calculation of chick costs
                            if (breed.type === "Layer") {
                                totalLayerChicks += bird.quantity;
                            } else if (breed.type === "Dual-Purpose") {
                                totalDualPurposeChicks += bird.quantity;
                            } else if (breed.type === "Meat") {
                                totalMeatChicks += bird.quantity;
                            }
                        }

                        const listItem = document.createElement('div');
                        listItem.classList.add('flex', 'justify-between', 'items-center', 'bg-white', 'p-4', 'rounded-md', 'shadow-sm', 'mb-3');
                        listItem.innerHTML = `
                            <span class="text-lg font-semibold text-gray-800">${bird.quantity}x ${bird.name}</span>
                            <button class="remove-bird-btn bg-red-600 text-white p-2 rounded-full hover:bg-red-700 transition-colors" data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 011-1h4a1 1 0 110 2H8a1 1 0 01-1-1zm2 3a1 1 0 00-1 1v3a1 1 0 102 0v-3a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        `;
                        flockList.appendChild(listItem);
                    });

                    // Add event listeners for remove buttons
                    document.querySelectorAll('.remove-bird-btn').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const indexToRemove = parseInt(e.currentTarget.dataset.index);
                            currentFlock.splice(indexToRemove, 1);
                            updateFlock(); // Re-render the flock list and recalculate
                        });
                    });

                    // Update production calculations
                    calculationResults.innerHTML = `
                        <div class="space-y-4">
                            <p class="text-xl text-gray-800"><strong class="text-[#1D8A99]">Estimated Annual Eggs:</strong> <span class="font-bold">${totalEggs.toLocaleString()}</span></p>
                            <p class="text-xl text-gray-800"><strong class="text-[#FF6F00]">Estimated Annual Meat:</strong> <span class="font-bold">${totalMeatLbs.toFixed(1)} lbs</span></p>
                            <p class="text-xl text-gray-800"><strong class="text-[#2F4F4F]">Total Birds in Flock:</strong> <span class="font-bold">${totalBirds}</span></p>
                        </div>
                    `;
                    calculateEconomics(totalLayerChicks, totalDualPurposeChicks, totalMeatChicks, totalEggs, totalMeatLbs, totalBirds);
                }
            }

            addBirdBtn.addEventListener('click', () => {
                const selectedBreedName = breedSelect.value;
                const quantity = parseInt(quantityInput.value);

                if (selectedBreedName && quantity > 0) {
                    const existingBird = currentFlock.find(bird => bird.name === selectedBreedName);
                    if (existingBird) {
                        existingBird.quantity += quantity;
                    } else {
                        currentFlock.push({ name: selectedBreedName, quantity: quantity });
                    }
                    updateFlock();
                    quantityInput.value = 1; // Reset quantity
                }
            });

            resetFlockBtn.addEventListener('click', () => {
                currentFlock = [];
                updateFlock();
            });

            // --- Flock Economics Logic ---
            const chickCostLayerInput = document.getElementById('chickCostLayerInput');
            const chickCostDualPurposeInput = document.getElementById('chickCostDualPurposeInput');
            const chickCostMeatInput = document.getElementById('chickCostMeatInput');
            const dailyFeedCostInput = document.getElementById('dailyFeedCostInput');
            const eggPriceDozenInput = document.getElementById('eggPriceDozenInput');
            const meatPriceLbInput = document.getElementById('meatPriceLbInput');
            const initialSetupCostInput = document.getElementById('initialSetupCostInput');
            const economicResults = document.getElementById('economicResults');

            const economicInputs = [
                chickCostLayerInput, chickCostDualPurposeInput, chickCostMeatInput,
                dailyFeedCostInput, eggPriceDozenInput, meatPriceLbInput, initialSetupCostInput
            ];

            economicInputs.forEach(input => {
                input.addEventListener('change', () => {
                    // Trigger update of economics whenever an input changes
                    const totalLayerChicks = currentFlock.filter(b => breedData.find(bd => bd.name === b.name)?.type === 'Layer').reduce((sum, b) => sum + b.quantity, 0);
                    const totalDualPurposeChicks = currentFlock.filter(b => breedData.find(bd => bd.name === b.name)?.type === 'Dual-Purpose').reduce((sum, b) => sum + b.quantity, 0);
                    const totalMeatChicks = currentFlock.filter(b => breedData.find(bd => bd.name === b.name)?.type === 'Meat').reduce((sum, b) => sum + b.quantity, 0);

                    let totalEggs = 0;
                    let totalMeatLbs = 0;
                    let totalBirds = 0;
                    currentFlock.forEach(bird => {
                        const breed = breedData.find(b => b.name === bird.name);
                        if (breed) {
                            // Calculate eggs for Layer and Dual-Purpose breeds
                            if (breed.type === "Layer" || breed.type === "Dual-Purpose") {
                                totalEggs += breed.eggsPerYear * bird.quantity;
                            }
                            // Calculate meat for Dual-Purpose and Meat breeds
                            if (breed.type === "Dual-Purpose" || breed.type === "Meat") {
                                const avgSlaughterWeight = (breed.henWeight + (breed.roosterWeight || breed.henWeight)) / 2;
                                totalMeatLbs += avgSlaughterWeight * bird.quantity;
                            }
                            totalBirds += bird.quantity;
                        }
                    });

                    calculateEconomics(totalLayerChicks, totalDualPurposeChicks, totalMeatChicks, totalEggs, totalMeatLbs, totalBirds);
                });
            });

            function calculateEconomics(numLayerChicks, numDualPurposeChicks, numMeatChicks, annualEggs, annualMeatLbs, totalBirdsInFlock) {
                const chickCostLayer = parseFloat(chickCostLayerInput.value) || 0;
                const chickCostDualPurpose = parseFloat(chickCostDualPurposeInput.value) || 0;
                const chickCostMeat = parseFloat(chickCostMeatInput.value) || 0;
                const dailyFeedCost = parseFloat(dailyFeedCostInput.value) || 0;
                const eggPriceDozen = parseFloat(eggPriceDozenInput.value) || 0;
                const meatPriceLb = parseFloat(meatPriceLbInput.value) || 0;
                const initialSetupCost = parseFloat(initialSetupCostInput.value) || 0;

                const totalChickCost = (numLayerChicks * chickCostLayer) +
                    (numDualPurposeChicks * chickCostDualPurpose) +
                    (numMeatChicks * chickCostMeat);

                const annualFeedCost = dailyFeedCost * 365 * totalBirdsInFlock;
                const totalAnnualCosts = annualFeedCost; // For now, only feed. Can add more later.

                const annualEggRevenue = (annualEggs / 12) * eggPriceDozen;
                const annualMeatRevenue = annualMeatLbs * meatPriceLb;
                const totalAnnualRevenue = annualEggRevenue + annualMeatRevenue;

                const netProfitLossYear1 = totalAnnualRevenue - (totalAnnualCosts + totalChickCost + initialSetupCost);
                const netProfitLossSubsequentYears = totalAnnualRevenue - totalAnnualCosts; // Assuming chicks and setup are year 1 only

                economicResults.innerHTML = `
                    <div class="space-y-4">
                        <p class="text-xl text-gray-800"><strong class="text-[#FF6F00]">Initial Bird Cost:</strong> <span class="font-bold">$${totalChickCost.toFixed(2)}</span></p>
                        <p class="text-xl text-gray-800"><strong class="text-[#FF6F00]">Annual Feed Cost:</strong> <span class="font-bold">$${annualFeedCost.toFixed(2)}</span></p>
                        <p class="text-xl text-gray-800"><strong class="text-[#FF6F00]">Initial Setup Cost:</strong> <span class="font-bold">$${initialSetupCost.toFixed(2)}</span></p>
                        <hr class="my-4 border-gray-300">
                        <p class="text-xl text-gray-800"><strong class="text-[#1D8A99]">Annual Egg Revenue:</strong> <span class="font-bold">$${annualEggRevenue.toFixed(2)}</span></p>
                        <p class="text-xl text-gray-800"><strong class="text-[#1D8A99]">Annual Meat Revenue:</strong> <span class="font-bold">$${annualMeatRevenue.toFixed(2)}</span></p>
                        <p class="text-2xl text-gray-900"><strong class="text-[#2F4F4F]">Net Profit/Loss (Year 1):</strong> <span class="font-extrabold ${netProfitLossYear1 >= 0 ? 'text-green-600' : 'text-red-600'}">$${netProfitLossYear1.toFixed(2)}</span></p>
                        ${totalBirdsInFlock > 0 ? `<p class="text-lg text-gray-700"><em>(Subsequent years' profit would be approx. $${netProfitLossSubsequentYears.toFixed(2)} assuming no chick replacement costs)</em></p>` : ''}
                    </div>
                `;
            }

            // --- Breed Characteristics Section Logic ---
            const breedCharacteristicsSelect = document.getElementById('breedCharacteristicsSelect');
            const breedCharacteristicsDisplay = document.getElementById('breedCharacteristicsDisplay');

            function populateCharacteristicsSelect() {
                breedCharacteristicsSelect.innerHTML = '';
                // Add a default "Select a breed" option
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Select a breed to view details";
                defaultOption.disabled = true;
                defaultOption.selected = true;
                breedCharacteristicsSelect.appendChild(defaultOption);

                breedData.forEach(breed => {
                    const option = document.createElement('option');
                    option.value = breed.name;
                    option.textContent = breed.name;
                    breedCharacteristicsSelect.appendChild(option);
                });
            }

            breedCharacteristicsSelect.addEventListener('change', () => {
                const selectedBreedName = breedCharacteristicsSelect.value;
                const breed = breedData.find(b => b.name === selectedBreedName);

                if (breed) {
                    let meatInfo = '';
                    if (breed.type === "Dual-Purpose" || breed.type === "Meat") {
                        meatInfo = `
                            <p class="text-lg text-gray-800"><strong class="text-[#2F4F4F]">Hen Weight:</strong> ${breed.henWeight} lbs</p>
                            <p class="text-lg text-gray-800"><strong class="text-[#2F4F4F]">Rooster Weight:</strong> ${breed.roosterWeight} lbs</p>
                        `;
                        if (breed.slaughterAgeWeeks) {
                            meatInfo += `<p class="text-lg text-gray-800"><strong class="text-[#2F4F4F]">Slaughter Age:</strong> ${breed.slaughterAgeWeeks} weeks</p>`;
                        }
                    }

                    let eggInfo = '';
                    // Only show egg info if the breed actually lays eggs (i.e., not a pure Meat breed with 0 eggs)
                    if (breed.eggsPerYear > 0) {
                        eggInfo = `
                            <p class="text-lg text-gray-800"><strong class="text-[#1D8A99]">Avg. Eggs/Year:</strong> ${breed.eggsPerYear}</p>
                            ${breed.eggColor && breed.eggColor !== "N/A" ? `
                                <p class="text-lg text-gray-800">
                                    <strong class="text-[#1D8A99]">Egg Color:</strong> 
                                    <span class="egg-color-dot" style="background-color: ${getEggColorCode(breed.eggColor)};"></span>
                                    ${breed.eggColor}
                                </p>
                            ` : ''}
                        `;
                    }


                    breedCharacteristicsDisplay.innerHTML = `
                        <div class="w-full text-left p-6 md:p-8">
                            ${breed.imageUrl ? `<img src="${breed.imageUrl}" alt="${breed.name}" class="w-full max-w-md h-auto object-contain mx-auto mb-4 border-4 border-gray-200 block" onerror="this.onerror=null;this.src='https://placehold.co/300x300/cccccc/000000?text=No+Image';">` : ''}
                            <h3 class="text-3xl font-extrabold text-gray-900 mb-3 text-center">${breed.name}</h3>
                            <p class="text-xl text-gray-800 text-center mb-4"><strong class="text-[#FF6F00]">Type:</strong> ${breed.type}</p>
                            <p class="text-lg text-gray-800 mb-4">${breed.characteristics}</p>
                            ${eggInfo}
                            ${meatInfo}
                        </div>
                    `;
                } else {
                    breedCharacteristicsDisplay.innerHTML = `
                        <div class="text-xl text-gray-800 text-center font-semibold">
                            Select a breed to see its characteristics.
                        </div>
                    `;
                }
            });

            function getEggColorCode(colorName) {
                switch (colorName.toLowerCase()) {
                    case 'brown': return '#8B4513'; // SaddleBrown
                    case 'dark brown (chocolate)': return '#4A2A0A'; // Dark Brown
                    case 'white': return '#F5F5DC'; // Beige
                    case 'blue/green': return '#A7D9D3'; // Light Blue-Green
                    case 'cream': return '#FFFDD0'; // Cream
                    case 'blue': return '#ADD8E6'; // LightBlue
                    case 'green': return '#90EE90'; // LightGreen
                    case 'light brown': return '#D2B48C'; // Tan
                    case 'n/a': return '#cccccc'; // Grey for N/A
                    default: return '#cccccc'; // Default grey
                }
            }

            // --- Custom Breed Form Logic ---
            const customBreedForm = document.getElementById('customBreedForm');
            const customBreedImageInput = document.getElementById('customBreedImage');
            const imagePreview = document.getElementById('imagePreview');
            let customBreedImageBase64 = null; // Store base64 for custom image

            customBreedImageInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        customBreedImageBase64 = e.target.result; // Store base64
                    };
                    reader.readAsDataURL(file);
                } else {
                    imagePreview.src = "";
                    imagePreview.classList.add('hidden');
                    customBreedImageBase64 = null;
                }
            });

            customBreedForm.addEventListener('submit', (event) => {
                event.preventDefault(); // Prevent default form submission

                const customBreed = {
                    name: document.getElementById('customBreedName').value,
                    type: document.getElementById('customBreedType').value,
                    eggsPerYear: parseInt(document.getElementById('customBreedEggs').value) || 0,
                    henWeight: parseFloat(document.getElementById('customBreedWeightHen').value) || 0,
                    roosterWeight: parseFloat(document.getElementById('customBreedWeightRooster').value) || 0, // Corrected ID
                    slaughterAgeWeeks: parseInt(document.getElementById('customBreedSlaughterAge').value) || null,
                    eggColor: document.getElementById('customBreedEggColor').value || "N/A",
                    characteristics: `A custom breed defined by you: ${document.getElementById('customBreedName').value}.`,
                    imageUrl: customBreedImageBase64 // Use the base64 string
                };

                // Add the custom breed to the global breedData
                breedData.push(customBreed);

                // Re-populate dropdowns to include the new breed
                populateBreedSelect();
                populateCharacteristicsSelect();
                renderCharts(); // Re-render charts to include new breed

                // Select the newly added custom breed in the flock builder dropdown
                breedSelect.value = customBreed.name;
                // Also select it in the characteristics dropdown and trigger its change event
                breedCharacteristicsSelect.value = customBreed.name;
                breedCharacteristicsSelect.dispatchEvent(new Event('change'));

                // Reset the form
                customBreedForm.reset();
                imagePreview.src = "";
                imagePreview.classList.add('hidden');
                customBreedImageBase64 = null;
                // Using a custom modal/message box instead of alert()
                displayMessage(`Custom breed "${customBreed.name}" added successfully and is now available in the selection lists!`, 'success');
            });

            // Generic message display (replaces alert/confirm)
            function displayMessage(message, type = 'info') {
                const messageBox = document.createElement('div');
                messageBox.classList.add('fixed', 'top-5', 'left-1/2', '-translate-x-1/2', 'p-4', 'rounded-lg', 'shadow-lg', 'z-50', 'text-white', 'font-bold');

                if (type === 'success') {
                    messageBox.classList.add('bg-green-500');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-500');
                } else {
                    messageBox.classList.add('bg-blue-500');
                }

                messageBox.textContent = message;
                document.body.appendChild(messageBox);

                setTimeout(() => {
                    messageBox.remove();
                }, 3000); // Remove after 3 seconds
            }

            // Set current year in footer
            document.getElementById('current-year').textContent = new Date().getFullYear();


            // Initial population and rendering
            populateBreedSelect();
            populateCharacteristicsSelect();
            renderCharts(); // Render charts on initial load
            updateFlock(); // Initialize flock display and economics
        });

    </script>
</body>

</html>